# üöÄ –¢–ï–°–¢: Google OAuth —Å –≤—ã–±–æ—Ä–æ–º —Ä–æ–ª–∏

## ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!

**Backend:** –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å `role: null` ‚úÖ  
**Frontend:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä —Ä–æ–ª–∏ –ø–æ—Å–ª–µ OAuth ‚úÖ  
**API:** –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–æ–ª—å –∏ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª–∏ ‚úÖ

---

## üß™ –ü–æ—à–∞–≥–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:**

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1 - Backend
cd backend && npm run start:dev

# –¢–µ—Ä–º–∏–Ω–∞–ª 2 - Frontend
cd frontend && npm run dev

# –ë—Ä–∞—É–∑–µ—Ä
http://localhost:3000
```

### **–®–∞–≥ 1: –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
localStorage.clear();
sessionStorage.clear();
```

### **–®–∞–≥ 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

1. **–ù–∞–∂–º–∏—Ç–µ "Sign Up"** ‚Üí AuthModal –æ—Ç–∫—Ä–æ–µ—Ç—Å—è
2. **–ù–∞–∂–º–∏—Ç–µ "Continue with Google"**
3. **–í—ã–±–µ—Ä–∏—Ç–µ –ù–û–í–´–ô Google –∞–∫–∫–∞—É–Ω—Ç** (–∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –≤ –±–∞–∑–µ)

### **–®–∞–≥ 3: –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**

–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:

‚úÖ **Backend –ª–æ–≥–∏:**

```
‚úÖ Created new user from Google OAuth (no role yet): [email]
‚úÖ GoogleAuth successful: { userRole: null, isNewUser: true }
```

‚úÖ **Frontend –∫–æ–Ω—Å–æ–ª—å:**

```
üîç OAuth callback parameters: { isNewUser: true }
üîç Profile response: { userRole: null }
‚úÖ User has no role - redirecting to role selection
üîç Home page - needs role selection, opening AuthModal
‚úÖ AuthModal - forcing role selection step
```

‚úÖ **–ù–∞ —ç–∫—Ä–∞–Ω–µ:** –í—ã–±–æ—Ä –º–µ–∂–¥—É "I'm looking for a place" –∏ "I have properties to rent"

### **–®–∞–≥ 4: –í—ã–±–æ—Ä —Ä–æ–ª–∏**

1. **–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å** (Tenant –∏–ª–∏ Operator)
2. **–ù–∞–∂–º–∏—Ç–µ "Continue"**

‚úÖ **–í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**

```
üîç AuthModal - calling setRole API for OAuth user
‚úÖ AuthModal - setRole successful
```

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ dashboard —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ä–æ–ª–∏

---

## üö® –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### **–ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ –≤–º–µ—Å—Ç–æ –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏**

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ Network tab –≤ DevTools
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–∑–æ–≤ `/auth/me` –ø–æ—Å–ª–µ OAuth callback
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `user.role === null` –≤ –æ—Ç–≤–µ—Ç–µ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å backend –ª–æ–≥–∏–∫—É —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### **–ü—Ä–æ–±–ª–µ–º–∞ 2: AuthModal –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ OAuth**

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ª–æ–≥–æ–≤ `"forcing role selection"`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `needsRole=true` –≤ URL

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å callback –ª–æ–≥–∏–∫—É –≤ `auth/callback/page.tsx`

### **–ü—Ä–æ–±–ª–µ–º–∞ 3: –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ setRole API**

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

1. Network tab ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–∑–æ–≤ `POST /auth/set-role`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ localStorage
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å backend –ª–æ–≥–∏

---

## üéØ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫:

- [ ] –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å `role: null`
- [ ] –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç redirect –Ω–∞ `/?needsRole=true`
- [ ] AuthModal –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å –≤—ã–±–æ—Ä–æ–º —Ä–æ–ª–∏
- [ ] –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–æ–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `setRole` API
- [ ] –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–æ—Ñ–∏–ª—å –∏ preferences –≤ –±–∞–∑–µ
- [ ] –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π dashboard

---

## üìä –°—Ö–µ–º–∞ –ø–æ—Ç–æ–∫–∞:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç Google
    ‚Üì
Google OAuth ‚Üí Backend —Å–æ–∑–¥–∞–µ—Ç user (role: null)
    ‚Üì
Frontend callback ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç role === null
    ‚Üì
Redirect: /?needsRole=true
    ‚Üì
–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ—Ç AuthModal
    ‚Üì
AuthModal ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä —Ä–æ–ª–∏
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç setRole API
    ‚Üì
Backend ‚Üí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–æ–ª—å, —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å
    ‚Üì
Frontend ‚Üí Redirect –Ω–∞ dashboard
```

**üéâ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**
